// import * as templates from './templates.json';
// import * as _pages from './pages.json';
// import * as _sections from './sections.json';

// const templates = require('./template.json');
const templates = {"3":{"id":"3","type":"DIV","text":"","attributes":{"src":"","style":"width: 100%;"},"elements":[{"id":"asdjfkygasdkjhfg","text":"","edit-type":"image","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":"height: 70px; position: absolute; margin: auto; top: 0px; left: 0px; right: 0px; bottom: 0px;"}}],"attributes":{"src":"","style":"height: 200px; width: 100%; position: relative;"}},{"id":"","text":"","type":"SECTION","elements":[{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"H1","elements":[],"attributes":{"src":"","style":"font-weight: 900 !important;"}},{"id":"fvcCd","text":"THU, 24.07.2017 - 11:00 AM","type":"P","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 15px;"}}],"attributes":{"src":"","style":"color: white; margin-top: 20px;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"6pBRp","text":"99 Marquardt Grove Suite 432","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 17px; padding: 10px;"}},{"id":"","text":"","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 17px; padding: 10px; color: green; border-top: 1px solid rgb(242, 242, 242); border-bottom: 1px solid rgb(242, 242, 242);"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":"width: 20px; margin: 5px 0px;"}},{"id":"QRbTW","text":"245 SQFT","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 13px;"}}],"attributes":{"src":"","style":"display: flex!important; flex-direction: column; justify-content: center; align-items: center; flex-basis: 33%; padding: 10px;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":"width: 20px; margin: 5px 0px;"}},{"id":"IJ2OE","text":"245 SQFT","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 13px;"}}],"attributes":{"src":"","style":"border-left: 1px solid rgb(242, 242, 242); border-right: 1px solid rgb(242, 242, 242); display: flex!important; flex-direction: column; justify-content: center; align-items: center; flex-basis: 33%; padding: 10px;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":"width: 20px; margin: 5px 0px;"}},{"id":"xeU2h","text":"245 SQFT","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 13px;"}}],"attributes":{"src":"","style":"display: flex!important; flex-direction: column; justify-content: center; align-items: center; flex-basis: 33%; padding: 10px;"}}],"attributes":{"src":"","style":"display: flex;"}},{"id":"","text":"","type":"A","elements":[],"attributes":{"src":"","style":"cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; height: 50px; width: 100%; font-size: 17px; background-color: rgb(54, 151, 218); color: white;"}}],"attributes":{"src":"","style":"display: flex; flex-direction: column; width: 60%; background-color: white; margin-top: auto; margin-bottom: auto;"}}],"attributes":{"src":"","style":"height: 400px; margin: 0px auto 50px; display: flex!important; flex-direction: column; align-items: center; text-align: center; background: url(\"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg\") 0% 0% / contain;"}},{"id":"","text":"","type":"SECTION","elements":[{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":""}}],"attributes":{"src":"","style":"height: 100%; width: 25%; overflow: hidden; margin-right: 5%; display: flex; align-items: center; justify-content: center;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":""}}],"attributes":{"src":"","style":"height: 65%; margin-bottom: 5%; overflow: hidden; display: flex; align-items: center; justify-content: center;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"12341234","text":"","editable":"image","type":"IMG","edit-type":"image","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":""}}],"attributes":{"src":"","style":"height: 35%; overflow: hidden; display: flex; align-items: center; justify-content: center;"}}],"attributes":{"src":"","style":"width: 70%; overflow: hidden; display: flex!important; flex-direction: column;"}}],"attributes":{"src":"","style":"height: 400px; margin: 50px auto; display: flex!important; width: 90%;"}},{"id":"","text":"","type":"SECTION","elements":[{"id":"","text":"","type":"DIV","elements":[],"attributes":{"src":"","style":"height: 100%; width: 5px; background-color: rgb(54, 151, 218); margin-right: 5%; margin-left: -5%;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"QBwdQ","text":"Some tit here","editable":"text","type":"H1","elements":[],"attributes":{"src":"","style":"margin-bottom: 30px; font-weight: 900 !important;"}},{"id":"UWw3w","text":"Attending a trade show can actually be a very effective\n                    method of promoting your company and its products","type":"P","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 15px; margin-bottom: 20px;"}},{"id":"","text":"","type":"P","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 15px; margin-bottom: 20px;"}}],"attributes":{"src":"","style":"width: 70%; margin-right: 5%;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":""}}],"attributes":{"src":"","style":"width: 25%; overflow: hidden; height: 100%; display: flex; align-items: center; justify-content: center;"}}],"attributes":{"src":"","style":"height: 400px; margin: 50px auto; display: flex; align-items: center; width: 90%;"}},{"id":"","text":"","type":"SECTION","elements":[{"id":"","text":"","type":"H1","elements":[],"attributes":{"src":"","style":"margin-bottom: 30px; font-weight: 900 !important;"}},{"id":"","text":"","type":"DIV","elements":[],"attributes":{"src":"","style":"width: 50px; height: 5px; background-color: rgb(54, 151, 218); margin: 0px auto 30px;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":""}}],"attributes":{"src":"","style":"display: flex; align-items: center; justify-content: center; height: 65%; overflow: hidden;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"uM6LR","text":"8368 Lockman iNLET sUITE 281,\n                        1254 City Name","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600;"}},{"id":"LPapT","text":"$ 326.234","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 17px; padding: 10px; color: green;"}}],"attributes":{"src":"","style":"font-size: 17px; padding: 10px; text-align: center; height: 20%; margin: 5px; display: flex; flex-direction: column; justify-content: center;"}},{"id":"","text":"","type":"A","elements":[],"attributes":{"src":"","style":"cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; height: 15%; width: 100%; font-size: 17px; background-color: rgb(54, 151, 218); color: white;"}}],"attributes":{"src":"","style":"display: flex; flex-direction: column; height: 500px; border: 1px solid rgb(242, 242, 242); margin-bottom: 50px;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":""}}],"attributes":{"src":"","style":"display: flex; align-items: center; justify-content: center; height: 65%; overflow: hidden;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"zUxaG","text":"8368 Lockman iNLET sUITE 281,\n                        1254 City Name","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600;"}},{"id":"grv3S","text":"$ 326.234","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 17px; padding: 10px; color: green;"}}],"attributes":{"src":"","style":"font-size: 17px; padding: 10px; text-align: center; height: 20%; margin: 5px; display: flex; flex-direction: column; justify-content: center;"}},{"id":"cSy57","text":"View property","type":"A","elements":[],"attributes":{"src":"","style":"cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; height: 15%; width: 100%; font-size: 17px; background-color: rgb(54, 151, 218); color: white;"}}],"attributes":{"src":"","style":"display: flex; flex-direction: column; height: 500px; border: 1px solid rgb(242, 242, 242); margin-bottom: 50px;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"DIV","elements":[{"id":"","text":"","type":"IMG","elements":[],"attributes":{"src":"https://s3-eu-west-1.amazonaws.com/zigna-web-client/images/emailmarketer/preview-ex.jpg","style":""}}],"attributes":{"src":"","style":"display: flex; align-items: center; justify-content: center; height: 65%; overflow: hidden;"}},{"id":"","text":"","type":"DIV","elements":[{"id":"hh0N7","text":"8368 Lockman iNLET sUITE 281,\n                        1254 City Name","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600;"}},{"id":"KDDFX","text":"$ 326.234","type":"SPAN","elements":[],"attributes":{"src":"","style":"font-weight: 600; font-size: 17px; padding: 10px; color: green;"}}],"attributes":{"src":"","style":"font-size: 17px; padding: 10px; text-align: center; height: 20%; margin: 5px; display: flex; flex-direction: column; justify-content: center;"}},{"id":"1BT8X","text":"View property","type":"A","elements":[],"attributes":{"src":"","style":"cursor: pointer; text-decoration: none; display: flex; align-items: center; justify-content: center; height: 15%; width: 100%; font-size: 17px; background-color: rgb(54, 151, 218); color: white;"}}],"attributes":{"src":"","style":"display: flex; flex-direction: column; height: 500px; border: 1px solid rgb(242, 242, 242); margin-bottom: 50px;"}}],"attributes":{"src":"","style":"height: auto; margin: 50px auto; width: 90%; text-align: center;"}},{"id":"","text":"","type":"FOOTER","elements":[{"id":"A9iO5","text":"INFORMATION","type":"H2","elements":[],"attributes":{"src":"","style":""}}],"attributes":{"src":"","style":"text-align: center; background-color: rgb(64, 64, 64); color: rgb(255, 255, 255); padding: 10px 0px 25px;"}},{"id":"odPv2","text":"542 Stoltenberg Passage Suite 928 \n                contact @emailservice.com \n                (2650) 246 348 2523","type":"P","elements":[{"id":"","text":"","type":"BR","elements":[],"attributes":{"src":"","style":""}},{"id":"","text":"","type":"BR","elements":[],"attributes":{"src":"","style":""}}],"attributes":{"src":"","style":"font-weight: 600; font-size: 15px;"}},{"id":"","text":"","type":"A","elements":[],"attributes":{"src":"","style":"cursor: pointer; text-decoration: none;"}}]}};
const projectData: any = {};
let changes: any = {};
export class CampaignParser
{
  public static getStructure(project)
  {
    changes = project.changes;
    let html = `<html><head><title>TUDOR</title>`;
    html += `</head><body>`;
    const id = project.templateID;
    let template = templates[id];
    if (!template) { template = templates[3]; }
    console.log(template);
    html += CampaignParser.addElements(html, template);
    html += `</body></html>`;
    return html;
  }

  public static addElements(html: string, section: any): string
  { 
    console.log(section);
    const elements = section.elements;
    if (!elements) { return html; }

    for (let j = 0; j < elements.length; j++)
    {
      const element = elements[j];

      const type = element.type.toLowerCase();
      html += `<${type}`;
      // check for attributes
      if (element.id) { html += ` id="${element.id}"`; }
      if (element.attributes)
      {
        let shouldReplace = true;
        for (const key in element.attributes)
        {
          if (element.attributes.hasOwnProperty(key))
          {
            if (key === 'onclick') { shouldReplace = false; }
          }
        }

        for (let key in element.attributes)
        {
          if (element.attributes.hasOwnProperty(key))
          {
            if (typeof element.attributes[key] !== 'string' || !shouldReplace)
            {
              html += ` ${key}="${element.attributes[key]}"`;
              continue;
            }
            let attribute = element.attributes[key];
            if (key === 'src' && element.id && changes.imageSources && changes.imageSources[element.id])
            {
              attribute = changes.imageSources[element.id];
            }
            if (!(type === 'a' && key === 'href')) { html += ` ${key}="${attribute}"`; }
            // else { targetAttribute = attribute; }

          }
        }
      }

      // if (targetAttribute || element.editable)
      // {
      //   targetAttribute = (targetAttribute) ? (`'${targetAttribute}'`) : (null);
      //   const editable = (element.editable) ? (`'${element.editable}'`) : (null);
      //   const editType = (element['edit-type']) ? (`'${element['edit-type']}'`) : (null);
      //   const add = ' onclick = elementClicked(event,' + targetAttribute + ',' + editable + ',' + editType + ')';
      //   html += add;
      // }

      html += `>`;

      // check for text
      let text = element.text;
      if (element.id && changes.text && changes.text[element.id]) { text = changes.text[element.id]; }
      if (text) { html += text; }

      if (element.elements) { html = CampaignParser.addElements(html, element); }

      // closing tag
      html += `</${element.type.toLowerCase()}>`;
    }

    return html;
  }
}
